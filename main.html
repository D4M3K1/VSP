<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>VSF Homepage</title>
<style>
  html, body {
    margin: 0; padding: 0; height: 100%;
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #0f0f0f 0%, #1c1c1c 100%);
    color: white;
    overflow: hidden;
    user-select: none;
  }
  #page-content {
    opacity: 0;
    transition: opacity 0.6s ease;
  }
  #page-content.fade-in {
    opacity: 1;
  }
  #page-content.fade-out {
    opacity: 0;
  }
  #header {
    text-align: center;
    font-size: 60px;
    font-weight: bold;
    margin-top: 20px;
  }
  #nav-buttons {
    max-width: 700px;
    margin: 20px auto;
    display: flex;
    justify-content: center;
    gap: 30px;
  }
  .nav-btn {
    padding: 15px 40px;
    background: black;
    border: 1px solid white;
    color: white;
    font-size: 18px;
    cursor: pointer;
    border-radius: 8px;
    transition: all 0.3s ease-in-out;
  }
  .nav-btn:hover {
    background: #111;
    box-shadow: 0 0 12px white;
  }
  #posts-container {
    max-width: 700px;
    margin: 20px auto;
    background: rgba(0,0,0,0.6);
    height: 65vh;
    overflow-y: auto;
    border-radius: 10px;
    padding: 15px 25px;
    box-shadow: 0 0 15px rgba(255,255,255,0.1);
  }
  .post {
    border-bottom: 1px solid #333;
    padding: 15px 0;
  }
  .post:last-child {
    border-bottom: none;
  }
  .post-user {
    color: #00ffcc;
    font-weight: bold;
    user-select: none;
  }
  .post-time {
    color: #888;
    font-size: 12px;
    user-select: none;
    margin-bottom: 6px;
  }
  .post-title {
    font-size: 18px;
    font-weight: bold;
    margin: 8px 0 6px 0;
  }
  .post-body {
    white-space: pre-wrap;
    margin-bottom: 10px;
  }
  .post img {
    max-width: 100%;
    border-radius: 5px;
  }
  canvas {
    position: fixed;
    top: 0; left: 0;
    pointer-events: none;
    z-index: 0;
  }
  #background-canvas {
    z-index: 0;
  }
  #tactical-lines-canvas {
    z-index: 1;
  }
</style>
</head>
<body>

  <canvas id="background-canvas"></canvas>
  <canvas id="tactical-lines-canvas"></canvas>

  <div id="page-content">
    <div id="header">VSF COMMUNITY</div>

    <div id="nav-buttons">
      <button class="nav-btn" id="go-chat">Go to Chat</button>
      <button class="nav-btn" id="go-feed">Go to Feed</button>
    </div>

    <div id="posts-container"></div>
  </div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

  <script type="module">
    
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import {
      getDatabase, ref, onChildAdded
    } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCMQh6NcBxIpNpM9J7ULGtjMukYGx4GyKg",
      authDomain: "vs-forces.firebaseapp.com",
      databaseURL: "https://vs-forces-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "vs-forces",
      storageBucket: "vs-forces.firebasestorage.app",
      messagingSenderId: "484336329710",
      appId: "1:484336329710:web:99f7f1d9ae0591571ea4ff",
      measurementId: "G-8PPXXCTFSQ"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const secretKey = 'vsf-community-secret'; // MUST MATCH feed.html

function decrypt(text) {
  try {
    return CryptoJS.AES.decrypt(text, secretKey).toString(CryptoJS.enc.Utf8);
  } catch (e) {
    return '[Decryption Error]';
  }
}

    const postsContainer = document.getElementById('posts-container');

    function formatTime(ts) {
      return new Date(ts).toLocaleString();
    }

    function createPostPreview(postData) {
  const div = document.createElement('div');
  div.classList.add('post');

  const userDiv = document.createElement('div');
  userDiv.className = 'post-user';
  userDiv.textContent = postData.user;
  div.appendChild(userDiv);

  const timeDiv = document.createElement('div');
  timeDiv.className = 'post-time';
  timeDiv.textContent = formatTime(postData.time);
  div.appendChild(timeDiv);

  if(postData.type === 'article') {
    const titleDiv = document.createElement('div');
    titleDiv.className = 'post-title';
    titleDiv.textContent = decrypt(postData.title);
    div.appendChild(titleDiv);

    const bodyDiv = document.createElement('div');
    bodyDiv.className = 'post-body';
    const fullBody = decrypt(postData.body);
    const snippet = fullBody.length > 150 ? fullBody.slice(0, 147) + '...' : fullBody;
    bodyDiv.textContent = snippet;
    div.appendChild(bodyDiv);

  } else if(postData.type === 'image') {
    const img = document.createElement('img');
    img.src = decrypt(postData.url); // Important!
    img.alt = 'User image post';
    img.loading = 'lazy';
    div.appendChild(img);
  }

  return div;
}


    const postsRef = ref(db, 'feedPosts');
    onChildAdded(postsRef, snapshot => {
      const postData = snapshot.val();
      const postEl = createPostPreview(postData);
      postsContainer.appendChild(postEl);
      postsContainer.scrollTop = postsContainer.scrollHeight;
    });
  </script>

  <!-- VSF particle background and tactical lines -->
  <script>
    const bgCanvas = document.getElementById('background-canvas');
    const bgCtx = bgCanvas.getContext('2d');
    let bgParticles = [];

    function resizeBgCanvas() {
      bgCanvas.width = window.innerWidth;
      bgCanvas.height = window.innerHeight;
    }
    resizeBgCanvas();
    window.addEventListener('resize', resizeBgCanvas);

    class BgParticle {
      constructor() { this.reset(); }
      reset() {
        this.x = Math.random() * bgCanvas.width;
        this.y = Math.random() * bgCanvas.height;
        this.radius = Math.random() * 2 + 0.5;
        this.speedY = Math.random() * 0.5 + 0.2;
        this.alpha = Math.random() * 0.5 + 0.3;
      }
      update() {
        this.y -= this.speedY;
        if (this.y < -this.radius) {
          this.y = bgCanvas.height + this.radius;
          this.x = Math.random() * bgCanvas.width;
        }
      }
      draw() {
        bgCtx.beginPath();
        bgCtx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        bgCtx.fillStyle = `rgba(255, 255, 255, ${this.alpha})`;
        bgCtx.fill();
      }
    }
    for (let i = 0; i < 150; i++) bgParticles.push(new BgParticle());
    function animateBgParticles() {
      bgCtx.clearRect(0, 0, bgCanvas.width, bgCanvas.height);
      bgParticles.forEach(p => { p.update(); p.draw(); });
      requestAnimationFrame(animateBgParticles);
    }
    animateBgParticles();

    const linesCanvas = document.getElementById('tactical-lines-canvas');
    const linesCtx = linesCanvas.getContext('2d');
    let lines = [];
    function resizeLinesCanvas() {
      linesCanvas.width = window.innerWidth;
      linesCanvas.height = window.innerHeight;
    }
    resizeLinesCanvas();
    window.addEventListener('resize', resizeLinesCanvas);

    class Line {
      constructor() { this.reset(); }
      reset() {
        this.x = Math.random() * linesCanvas.width;
        this.y = Math.random() * linesCanvas.height;
        this.length = Math.random() * 100 + 50;
        this.speedX = (Math.random() - 0.5) * 0.3;
        this.speedY = (Math.random() - 0.5) * 0.3;
        this.opacity = Math.random() * 0.3 + 0.1;
        this.angle = Math.random() * Math.PI * 2;
        this.angularSpeed = (Math.random() - 0.5) * 0.01;
      }
      update() {
        this.x += this.speedX;
        this.y += this.speedY;
        this.angle += this.angularSpeed;
        if (this.x < -this.length) this.x = linesCanvas.width + this.length;
        if (this.x > linesCanvas.width + this.length) this.x = -this.length;
        if (this.y < -this.length) this.y = linesCanvas.height + this.length;
        if (this.y > linesCanvas.height + this.length) this.y = -this.length;
      }
      draw() {
        linesCtx.save();
        linesCtx.translate(this.x, this.y);
        linesCtx.rotate(this.angle);
        linesCtx.strokeStyle = `rgba(255, 255, 255, ${this.opacity})`;
        linesCtx.lineWidth = 1;
        linesCtx.beginPath();
        linesCtx.moveTo(-this.length / 2, 0);
        linesCtx.lineTo(this.length / 2, 0);
        linesCtx.stroke();
        linesCtx.restore();
      }
    }
    for (let i = 0; i < 40; i++) lines.push(new Line());
    function animateLines() {
      linesCtx.clearRect(0, 0, linesCanvas.width, linesCanvas.height);
      lines.forEach(line => { line.update(); line.draw(); });
      requestAnimationFrame(animateLines);
    }
    animateLines();
  </script>

  <script>
    // Fade in page on load
    const pageContent = document.getElementById('page-content');
    window.addEventListener('load', () => {
      pageContent.classList.add('fade-in');
    });

    // Fade out on nav buttons click then navigate
    document.getElementById('go-chat').addEventListener('click', (e) => {
      e.preventDefault();
      pageContent.classList.remove('fade-in');
      pageContent.classList.add('fade-out');
      setTimeout(() => {
        window.location.href = 'chat.html';
      }, 600);
    });

    document.getElementById('go-feed').addEventListener('click', (e) => {
      e.preventDefault();
      pageContent.classList.add('fade-in');
      pageContent.classList.add('fade-out');
      setTimeout(() => {
        window.location.href = 'feed.html';
      }, 800);
    });
  </script>

  <script>
    // Disable right-click, devtools shortcuts, and detect devtools open
    document.addEventListener('contextmenu', e => e.preventDefault());
    document.addEventListener('keydown', e => {
      if (
        e.key === "F12" ||
        (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J')) ||
        (e.ctrlKey && e.key === 'U') ||
        (e.metaKey && e.altKey && e.key === 'I')
      ) {
        e.preventDefault();
        return false;
      }
    });

    setInterval(() => {
      const widthThreshold = window.outerWidth - window.innerWidth > 100;
      const heightThreshold = window.outerHeight - window.innerHeight > 100;
      if (widthThreshold || heightThreshold) {
        document.body.innerHTML = '<h1 style="color:white;text-align:center;margin-top:40vh;">Access Denied</h1>';
      }
    }, 1000);
  </script>

</body>
</html>

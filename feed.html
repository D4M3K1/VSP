<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>VSF Community Feed</title>

<style>
  html, body {
    margin: 0; padding: 0; height: 100%;
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #0f0f0f 0%, #1c1c1c 100%);
    color: white;
    overflow: hidden;
  }
  #page-content {
  opacity: 0;
  transition: opacity 0.5s ease;
}

#page-content.fade-in {
  opacity: 1;
}

#page-content.fade-out {
  opacity: 0;
}

      #top-nav {
  text-align: center;
  margin: 15px 0 0 0;
  z-index: 2;
  position: relative;
  user-select: none;
}

#go-home-btn {
  padding: 10px 30px;
  font-size: 16px;
  background: black;
  border: 1px solid white;
  color: white;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.3s ease-in-out;
}

#go-home-btn:hover {
  background: #111;
  box-shadow: 0 0 10px white;
}
  #header {
    text-align: center;
    font-size: 60px;
    font-weight: bold;
    margin-top: 20px;
    user-select: none;
  }
  #post-form {
    max-width: 650px;
    margin: 20px auto;
    background: rgba(0,0,0,0.6);
    padding: 20px;
    border-radius: 10px;
    display: flex;
    align-items: flex-start;
    gap: 15px;
  }
  #post-type-container {
    flex-shrink: 0;
    display: flex;
    flex-direction: column;
  }
  #post-type-container label {
    font-weight: bold;
    margin-bottom: 8px;
  }
  #post-type {
    width: 120px;
    padding: 10px;
    background: #111;
    border: 1px solid white;
    color: white;
    border-radius: 5px;
    cursor: pointer;
  }
  #fields-container {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  #article-fields label,
  #media-url-field label {
    font-weight: bold;
    display: block;
    margin-bottom: 6px;
  }
  #article-fields input[type="text"],
  #article-fields textarea,
  #media-url-field input[type="text"] {
    width: 100%;
    padding: 10px;
    background: #111;
    border: 1px solid white;
    color: white;
    border-radius: 5px;
    resize: vertical;
  }
  #article-fields textarea {
    height: 100px;
  }
  #post-submit {
    margin-top: 15px;
    padding: 12px 25px;
    background: black;
    border: 1px solid white;
    color: white;
    cursor: pointer;
    font-size: 16px;
    border-radius: 5px;
    transition: all 0.3s ease-in-out;
    align-self: flex-start;
  }
  #post-submit:hover {
    background: #111;
    box-shadow: 0 0 10px white;
  }
  #feed {
    max-width: 650px;
    margin: 20px auto;
    overflow-y: auto;
    height: 60vh;
    background: rgba(0,0,0,0.6);
    border-radius: 10px;
    padding: 10px 20px;
    box-shadow: 0 0 15px rgba(255,255,255,0.1);
  }
  .post {
    border-bottom: 1px solid #333;
    padding: 15px 0;
  }
  .post:last-child {
    border-bottom: none;
  }
  .post .post-user {
    color: #00ffcc;
    font-weight: bold;
    user-select: none;
  }
  .post .post-time {
    color: #888;
    font-size: 12px;
    user-select: none;
    margin-bottom: 8px;
  }
  .post .post-title {
    font-size: 18px;
    font-weight: bold;
    margin: 8px 0 6px 0;
  }
  .post .post-body {
    white-space: pre-wrap;
    margin-bottom: 10px;
  }
  .post img {
    max-width: 100%;
    border-radius: 5px;
  }
  .comments-container {
    margin-top: 15px;
    border-top: 1px solid #444;
    padding-top: 10px;
  }
  .comment {
    margin-bottom: 8px;
    font-size: 14px;
    border-bottom: 1px solid #222;
    padding-bottom: 6px;
  }
  .comment .comment-user {
    color: #00ffcc;
    font-weight: bold;
    user-select: none;
    margin-right: 6px;
  }
  .comment .comment-time {
    color: #666;
    font-size: 11px;
  }
  .comment-text {
    margin-left: 20px;
    white-space: pre-wrap;
  }
  .comment-form {
    margin-top: 10px;
    display: flex;
    gap: 10px;
  }
  .comment-input {
    flex: 1;
    padding: 8px;
    border-radius: 5px;
    border: 1px solid white;
    background: #111;
    color: white;
  }
  .comment-submit-btn {
    background: black;
    border: 1px solid white;
    color: white;
    padding: 8px 15px;
    cursor: pointer;
    border-radius: 5px;
    transition: all 0.3s ease-in-out;
  }
  .comment-submit-btn:hover {
    background: #111;
    box-shadow: 0 0 8px white;
  }

  canvas {
    position: fixed;
    top: 0; left: 0;
    pointer-events: none;
    z-index: 0;
  }
  #background-canvas {
    z-index: 0;
  }
  #tactical-lines-canvas {
    z-index: 1;
  }
</style>
</head>
<body>

  <canvas id="background-canvas"></canvas>
  <canvas id="tactical-lines-canvas"></canvas>
  
<div id="page-content">
  <div id="top-nav">
  <button id="go-home-btn">Go to Homepage</button>
  </div>
  <div id="header">VSF COMMUNITY FEED</div>

  <form id="post-form">
    <div id="post-type-container">
      <label for="post-type">Post Type</label>
      <select id="post-type" name="post-type" required>
        <option value="article">Article</option>
        <option value="image">Image URL</option>
      </select>
    </div>

    <div id="fields-container">
      <div id="article-fields">
        <label for="article-title">Title</label>
        <input type="text" id="article-title" name="article-title" maxlength="100" placeholder="Article Title" />
        <label for="article-body">Body</label>
        <textarea id="article-body" name="article-body" maxlength="2000" placeholder="Write your article here..."></textarea>
      </div>

      <div id="media-url-field" style="display:none;">
        <label for="media-url">Image URL</label>
        <input type="text" id="media-url" name="media-url" placeholder="Paste direct image URL here" />
      </div>

      <button type="submit" id="post-submit">Post</button>
    </div>
  </form>

  <div id="feed"></div>
</div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import {
      getDatabase, ref, push, onChildAdded, onValue
    } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCMQh6NcBxIpNpM9J7ULGtjMukYGx4GyKg",
      authDomain: "vs-forces.firebaseapp.com",
      databaseURL: "https://vs-forces-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "vs-forces",
      storageBucket: "vs-forces.firebasestorage.app",
      messagingSenderId: "484336329710",
      appId: "1:484336329710:web:99f7f1d9ae0591571ea4ff",
      measurementId: "G-8PPXXCTFSQ"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const postTypeSelect = document.getElementById('post-type');
    const articleFields = document.getElementById('article-fields');
    const mediaUrlField = document.getElementById('media-url-field');
    const postForm = document.getElementById('post-form');
    const feed = document.getElementById('feed');

    const userId = `User #${Math.floor(Math.random() * 9000 + 1000)}`;

    // Toggle form fields depending on post type
    postTypeSelect.addEventListener('change', () => {
      const val = postTypeSelect.value;
      if(val === 'article') {
        articleFields.style.display = 'block';
        mediaUrlField.style.display = 'none';
      } else {
        articleFields.style.display = 'none';
        mediaUrlField.style.display = 'block';
        document.getElementById('media-url').placeholder = 'Paste direct image URL here';
      }
    });
    postTypeSelect.dispatchEvent(new Event('change'));

    // Submit new post
    postForm.addEventListener('submit', e => {
      e.preventDefault();
      const type = postTypeSelect.value;

      let postData = {
        user: userId,
        type,
        time: Date.now()
      };

      if(type === 'article') {
        const title = document.getElementById('article-title').value.trim();
        const body = document.getElementById('article-body').value.trim();
        if(!title || !body) {
          alert('Please enter title and body for your article.');
          return;
        }
        postData.title = title;
        postData.body = body;
      } else if(type === 'image') {
        const url = document.getElementById('media-url').value.trim();
        if(!url) {
          alert('Please enter an image URL.');
          return;
        }
        postData.url = url;
      }

      push(ref(db, 'feedPosts'), postData);

      // Clear form
      if(type === 'article') {
        document.getElementById('article-title').value = '';
        document.getElementById('article-body').value = '';
      } else if(type === 'image') {
        document.getElementById('media-url').value = '';
      }
    });

    // Helper: Format timestamp
    function formatTime(ts) {
      return new Date(ts).toLocaleString();
    }

    // Render a single comment element
    function renderComment(commentData) {
      const commentDiv = document.createElement('div');
      commentDiv.className = 'comment';

      const userSpan = document.createElement('span');
      userSpan.className = 'comment-user';
      userSpan.textContent = commentData.user;

      const timeSpan = document.createElement('span');
      timeSpan.className = 'comment-time';
      timeSpan.textContent = ' - ' + formatTime(commentData.time);

      const textDiv = document.createElement('div');
      textDiv.className = 'comment-text';
      textDiv.textContent = commentData.text;

      commentDiv.appendChild(userSpan);
      commentDiv.appendChild(timeSpan);
      commentDiv.appendChild(textDiv);

      return commentDiv;
    }

    // Create a post DOM element with comments & comment form
    function createPostElement(postKey, postData) {
      const div = document.createElement('div');
      div.classList.add('post');

      const userDiv = document.createElement('div');
      userDiv.className = 'post-user';
      userDiv.textContent = postData.user;
      div.appendChild(userDiv);

      const timeDiv = document.createElement('div');
      timeDiv.className = 'post-time';
      timeDiv.textContent = formatTime(postData.time);
      div.appendChild(timeDiv);

      if(postData.type === 'article') {
        const titleDiv = document.createElement('div');
        titleDiv.className = 'post-title';
        titleDiv.textContent = postData.title;
        div.appendChild(titleDiv);

        const bodyDiv = document.createElement('div');
        bodyDiv.className = 'post-body';
        bodyDiv.textContent = postData.body;
        div.appendChild(bodyDiv);
      } else if(postData.type === 'image') {
        const img = document.createElement('img');
        img.src = postData.url;
        img.alt = 'User image post';
        img.loading = 'lazy';
        div.appendChild(img);
      }

      // Comments container
      const commentsContainer = document.createElement('div');
      commentsContainer.className = 'comments-container';
      div.appendChild(commentsContainer);

      // Comment form
      const commentForm = document.createElement('form');
      commentForm.className = 'comment-form';

      const commentInput = document.createElement('input');
      commentInput.type = 'text';
      commentInput.placeholder = 'Write a comment...';
      commentInput.className = 'comment-input';
      commentInput.required = true;
      commentForm.appendChild(commentInput);

      const commentSubmit = document.createElement('button');
      commentSubmit.type = 'submit';
      commentSubmit.className = 'comment-submit-btn';
      commentSubmit.textContent = 'Reply';
      commentForm.appendChild(commentSubmit);

      div.appendChild(commentForm);

      // Load existing comments from Firebase
      const commentsRef = ref(db, `feedPosts/${postKey}/comments`);
      onValue(commentsRef, snapshot => {
        commentsContainer.innerHTML = ''; // Clear current comments
        const comments = snapshot.val();
        if(comments) {
          Object.entries(comments).forEach(([key, comment]) => {
            const commentEl = renderComment(comment);
            commentsContainer.appendChild(commentEl);
          });
        }
      });

      // Handle new comment submit
      commentForm.addEventListener('submit', e => {
        e.preventDefault();
        const text = commentInput.value.trim();
        if(!text) return;

        const commentData = {
          user: userId,
          text,
          time: Date.now()
        };

        push(ref(db, `feedPosts/${postKey}/comments`), commentData);
        commentInput.value = '';
      });

      return div;
    }

    // Listen for new posts and add them to feed
    const postsRef = ref(db, 'feedPosts');
    onChildAdded(postsRef, snapshot => {
      const postKey = snapshot.key;
      const postData = snapshot.val();

      const postEl = createPostElement(postKey, postData);
      feed.appendChild(postEl);
      feed.scrollTop = feed.scrollHeight;
    });

    // === Background Floating Particles ===
    const bgCanvas = document.getElementById('background-canvas');
    const bgCtx = bgCanvas.getContext('2d');
    let bgParticles = [];

    function resizeBgCanvas() {
      bgCanvas.width = window.innerWidth;
      bgCanvas.height = window.innerHeight;
    }
    resizeBgCanvas();
    window.addEventListener('resize', resizeBgCanvas);

    class BgParticle {
      constructor() { this.reset(); }
      reset() {
        this.x = Math.random() * bgCanvas.width;
        this.y = Math.random() * bgCanvas.height;
        this.radius = Math.random() * 2 + 0.5;
        this.speedY = Math.random() * 0.5 + 0.2;
        this.alpha = Math.random() * 0.5 + 0.3;
      }
      update() {
        this.y -= this.speedY;
        if (this.y < -this.radius) {
          this.y = bgCanvas.height + this.radius;
          this.x = Math.random() * bgCanvas.width;
        }
      }
      draw() {
        bgCtx.beginPath();
        bgCtx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        bgCtx.fillStyle = `rgba(255, 255, 255, ${this.alpha})`;
        bgCtx.fill();
      }
    }
    for (let i = 0; i < 150; i++) bgParticles.push(new BgParticle());
    function animateBgParticles() {
      bgCtx.clearRect(0, 0, bgCanvas.width, bgCanvas.height);
      bgParticles.forEach(p => { p.update(); p.draw(); });
      requestAnimationFrame(animateBgParticles);
    }
    animateBgParticles();

    // === Tactical Lines Animation ===
    const linesCanvas = document.getElementById('tactical-lines-canvas');
    const linesCtx = linesCanvas.getContext('2d');
    let lines = [];
    function resizeLinesCanvas() {
      linesCanvas.width = window.innerWidth;
      linesCanvas.height = window.innerHeight;
    }
    resizeLinesCanvas();
    window.addEventListener('resize', resizeLinesCanvas);

    class Line {
      constructor() { this.reset(); }
      reset() {
        this.x = Math.random() * linesCanvas.width;
        this.y = Math.random() * linesCanvas.height;
        this.length = Math.random() * 100 + 50;
        this.speedX = (Math.random() - 0.5) * 0.3;
        this.speedY = (Math.random() - 0.5) * 0.3;
        this.opacity = Math.random() * 0.3 + 0.1;
        this.angle = Math.random() * Math.PI * 2;
        this.angularSpeed = (Math.random() - 0.5) * 0.01;
      }
      update() {
        this.x += this.speedX;
        this.y += this.speedY;
        this.angle += this.angularSpeed;
        if (this.x < -this.length) this.x = linesCanvas.width + this.length;
        if (this.x > linesCanvas.width + this.length) this.x = -this.length;
        if (this.y < -this.length) this.y = linesCanvas.height + this.length;
        if (this.y > linesCanvas.height + this.length) this.y = -this.length;
      }
      draw() {
        linesCtx.save();
        linesCtx.translate(this.x, this.y);
        linesCtx.rotate(this.angle);
        linesCtx.strokeStyle = `rgba(255, 255, 255, ${this.opacity})`;
        linesCtx.lineWidth = 1;
        linesCtx.beginPath();
        linesCtx.moveTo(-this.length / 2, 0);
        linesCtx.lineTo(this.length / 2, 0);
        linesCtx.stroke();
        linesCtx.restore();
      }
    }
    for (let i = 0; i < 40; i++) lines.push(new Line());
    function animateLines() {
      linesCtx.clearRect(0, 0, linesCanvas.width, linesCanvas.height);
      lines.forEach(line => { line.update(); line.draw(); });
      requestAnimationFrame(animateLines);
    }
    animateLines();
    const pageContent = document.getElementById('page-content');

// Fade in on load
window.addEventListener('load', () => {
  pageContent.classList.add('fade-in');
});

// Fade out on navigation
document.getElementById('go-home-btn').addEventListener('click', (e) => {
  e.preventDefault();
  pageContent.classList.remove('fade-in');
  pageContent.classList.add('fade-out');
  setTimeout(() => {
    window.location.href = 'main.html';
  }, 500); // Match transition duration
});

  </script>
  <script>
        document.addEventListener('contextmenu', e => e.preventDefault());
      document.addEventListener('keydown', e => {
        if (
          e.key === "F12" ||
          (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J')) ||
          (e.ctrlKey && e.key === 'U') ||
          (e.metaKey && e.altKey && e.key === 'I')
        ) {
          e.preventDefault();
          return false;
        }
      });
      setInterval(() => {
      const widthThreshold = window.outerWidth - window.innerWidth > 100;
      const heightThreshold = window.outerHeight - window.innerHeight > 100;
      if (widthThreshold || heightThreshold) {
        document.body.innerHTML = '<h1 style="color:white;text-align:center;margin-top:40vh;">Access Denied</h1>';
      }
    }, 1000);
    </script>
</body>
</html>

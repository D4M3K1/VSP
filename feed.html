<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>VSF Feed</title>
  <style>
    html, body {
      margin: 0; padding: 0; height: 100%;
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #0f0f0f, #1c1c1c);
      color: white;
      overflow: hidden;
    }
    #container {
      max-width: 800px;
      margin: 40px auto;
      background: rgba(0,0,0,0.6);
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(255,255,255,0.1);
      padding: 20px;
      height: 80vh;
      display: flex;
      flex-direction: column;
    }
    h1 {
      text-align: center;
      margin-bottom: 15px;
      user-select: none;
    }
    form {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 20px;
    }
    input[type="text"], textarea {
      width: 100%;
      background: #111;
      border: 1px solid white;
      border-radius: 5px;
      color: white;
      padding: 8px;
      font-size: 14px;
      resize: vertical;
    }
    textarea {
      min-height: 60px;
      max-height: 150px;
    }
    select {
      background: #111;
      border: 1px solid white;
      border-radius: 5px;
      color: white;
      padding: 8px;
      font-size: 14px;
      width: 150px;
    }
    button {
      width: 150px;
      cursor: pointer;
      font-size: 16px;
      background: black;
      color: white;
      border: 1px solid white;
      border-radius: 5px;
      transition: all 0.4s ease;
      align-self: flex-start;
      user-select: none;
    }
    button:hover {
      background: #111;
      box-shadow: 0 0 10px white;
    }
    #posts {
      flex: 1;
      overflow-y: auto;
      border-top: 1px solid #444;
      padding-top: 15px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .post-card {
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 0 5px rgba(255,255,255,0.1);
    }
    .post-header {
      font-weight: bold;
      margin-bottom: 10px;
      color: #00ffcc;
      user-select: none;
    }
    .post-title {
      font-size: 18px;
      margin-bottom: 8px;
    }
    .post-body {
      font-size: 15px;
      white-space: pre-wrap;
      margin-bottom: 10px;
    }
    img, video {
      max-width: 100%;
      border-radius: 5px;
      display: block;
      margin-top: 10px;
      background: black;
    }
    video {
      max-height: 300px;
    }
    #clear-btn {
      background: #800000;
      margin-top: 10px;
      align-self: flex-end;
    }
    #clear-btn:hover {
      background: #b22222;
      box-shadow: 0 0 12px #b22222;
    }

    /* Canvas layers */
    canvas {
      position: fixed;
      top: 0; left: 0;
      pointer-events: none;
      z-index: 0;
    }
    #background-canvas { z-index: 0; }
    #tactical-lines-canvas { z-index: 1; }
  </style>
</head>
<body>

  <canvas id="background-canvas"></canvas>
  <canvas id="tactical-lines-canvas"></canvas>

  <div id="container">
    <h1>VSF Feed</h1>

    <form id="post-form">
      <label>
        Post Type:
        <select id="post-type" required>
          <option value="article">Article</option>
          <option value="image">Image URL</option>
          <option value="video">Video URL</option>
        </select>
      </label>

      <div id="article-fields">
        <input type="text" id="post-title" placeholder="Article Title (required)" />
        <textarea id="post-body" placeholder="Write your article here..." rows="4"></textarea>
      </div>

      <div id="media-fields" style="display:none;">
        <input type="text" id="media-url" placeholder="Enter URL here" />
      </div>

      <button type="submit">Post</button>
    </form>

    <button id="clear-btn" title="Clear all posts (creator only)">Clear All Posts</button>

    <div id="posts"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import { getDatabase, ref, push, onChildAdded, query, limitToLast, get, remove } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";

    // Your Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCMQh6NcBxIpNpM9J7ULGtjMukYGx4GyKg",
      authDomain: "vs-forces.firebaseapp.com",
      databaseURL: "https://vs-forces-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "vs-forces",
      storageBucket: "vs-forces.firebasestorage.app",
      messagingSenderId: "484336329710",
      appId: "1:484336329710:web:99f7f1d9ae0591571ea4ff",
      measurementId: "G-8PPXXCTFSQ"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Anonymous "creator" user
    const userId = `User #${Math.floor(Math.random()*9000+1000)}`;

    const postForm = document.getElementById('post-form');
    const postTypeSelect = document.getElementById('post-type');
    const articleFields = document.getElementById('article-fields');
    const mediaFields = document.getElementById('media-fields');
    const postTitle = document.getElementById('post-title');
    const postBody = document.getElementById('post-body');
    const mediaUrl = document.getElementById('media-url');
    const postsContainer = document.getElementById('posts');
    const clearBtn = document.getElementById('clear-btn');

    // Show/hide fields depending on post type
    postTypeSelect.addEventListener('change', () => {
      if(postTypeSelect.value === 'article') {
        articleFields.style.display = 'flex';
        mediaFields.style.display = 'none';
        postTitle.required = true;
      } else {
        articleFields.style.display = 'none';
        mediaFields.style.display = 'block';
        postTitle.required = false;
      }
    });

    postForm.addEventListener('submit', e => {
      e.preventDefault();

      const type = postTypeSelect.value;
      const time = Date.now();

      // Validate fields
      if(type === 'article') {
        if(!postTitle.value.trim()) {
          alert('Article title is required!');
          return;
        }
      } else {
        if(!mediaUrl.value.trim()) {
          alert('URL is required!');
          return;
        }
      }

      // Prepare post data
      const newPost = {
        user: userId,
        type,
        time,
      };

      if(type === 'article') {
        newPost.title = postTitle.value.trim();
        newPost.body = postBody.value.trim();
      } else {
        newPost.url = mediaUrl.value.trim();
      }

      // Push post to Firebase DB
      push(ref(db, 'posts'), newPost);

      // Reset form
      postForm.reset();
      postTypeSelect.dispatchEvent(new Event('change'));
    });

    // Listen for posts and render
    const postsQuery = query(ref(db, 'posts'), limitToLast(50));
    onChildAdded(postsQuery, snapshot => {
      const post = snapshot.val();
      post.key = snapshot.key;

      const card = document.createElement('div');
      card.className = 'post-card';

      const header = document.createElement('div');
      header.className = 'post-header';
      header.textContent = post.user;
      card.appendChild(header);

      if(post.type === 'article') {
        const title = document.createElement('div');
        title.className = 'post-title';
        title.textContent = post.title;
        card.appendChild(title);

        if(post.body) {
          const body = document.createElement('div');
          body.className = 'post-body';
          body.textContent = post.body;
          card.appendChild(body);
        }
      } else if(post.type === 'image') {
        const img = document.createElement('img');
        img.src = post.url;
        img.alt = 'User image post';
        card.appendChild(img);
      } else if(post.type === 'video') {
        const vid = document.createElement('video');
        vid.src = post.url;
        vid.controls = true;
        card.appendChild(vid);
      }

      postsContainer.appendChild(card);
      postsContainer.scrollTop = postsContainer.scrollHeight;
    });

    // Auto-delete posts older than 20 minutes
    setInterval(() => {
      const cutoff = Date.now() - 20*60*1000; // 20 mins
      get(ref(db, 'posts')).then(snapshot => {
        snapshot.forEach(child => {
          if(child.val().time < cutoff) {
            remove(ref(db, `posts/${child.key}`));
          }
        });
      });
    }, 2*60*1000); // every 2 mins

    // Clear all posts (only for creator)
    clearBtn.addEventListener('click', () => {
      if(confirm('Are you sure you want to clear all posts?')) {
        remove(ref(db, 'posts'));
        postsContainer.innerHTML = '';
      }
    });

    // Initialize form visibility
    postTypeSelect.dispatchEvent(new Event('change'));


    // === Reuse VSF background and tactical lines canvas scripts from your main.html ===
    const bgCanvas = document.getElementById('background-canvas');
    const bgCtx = bgCanvas.getContext('2d');
    let bgParticles = [];

    function resizeBgCanvas() {
      bgCanvas.width = window.innerWidth;
      bgCanvas.height = window.innerHeight;
    }

    resizeBgCanvas();
    window.addEventListener('resize', resizeBgCanvas);

    class BgParticle {
      constructor() {
        this.reset();
      }

      reset() {
        this.x = Math.random() * bgCanvas.width;
        this.y = Math.random() * bgCanvas.height;
        this.radius = Math.random() * 2 + 0.5;
        this.speedY = Math.random() * 0.5 + 0.2;
        this.alpha = Math.random() * 0.5 + 0.3;
      }

      update() {
        this.y -= this.speedY;
        if (this.y < -this.radius) {
          this.y = bgCanvas.height + this.radius;
          this.x = Math.random() * bgCanvas.width;
        }
      }

      draw() {
        bgCtx.beginPath();
        bgCtx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        bgCtx.fillStyle = `rgba(255, 255, 255, ${this.alpha})`;
        bgCtx.fill();
      }
    }

    for (let i = 0; i < 150; i++) {
      bgParticles.push(new BgParticle());
    }

    function animateBgParticles() {
      bgCtx.clearRect(0, 0, bgCanvas.width, bgCanvas.height);
      bgParticles.forEach(p => {
        p.update();
        p.draw();
      });
      requestAnimationFrame(animateBgParticles);
    }

    animateBgParticles();


    const linesCanvas = document.getElementById('tactical-lines-canvas');
    const linesCtx = linesCanvas.getContext('2d');
    let lines = [];

    function resizeLinesCanvas() {
      linesCanvas.width = window.innerWidth;
      linesCanvas.height = window.innerHeight;
    }

    resizeLinesCanvas();
    window.addEventListener('resize', resizeLinesCanvas);

    class Line {
      constructor() {
        this.reset();
      }

      reset() {
        this.x = Math.random() * linesCanvas.width;
        this.y = Math.random() * linesCanvas.height;
        this.length = Math.random() * 100 + 50;
        this.speedX = (Math.random() - 0.5) * 0.3;
        this.speedY = (Math.random() - 0.5) * 0.3;
        this.opacity = Math.random() * 0.3 + 0.1;
        this.angle = Math.random() * Math.PI * 2;
        this.angularSpeed = (Math.random() - 0.5) * 0.01;
      }

      update() {
        this.x += this.speedX;
        this.y += this.speedY;
        this.angle += this.angularSpeed;

        if (this.x < -this.length) this.x = linesCanvas.width + this.length;
        if (this.x > linesCanvas.width + this.length) this.x = -this.length;
        if (this.y < -this.length) this.y = linesCanvas.height + this.length;
        if (this.y > linesCanvas.height + this.length) this.y = -this.length;
      }

      draw() {
        linesCtx.save();
        linesCtx.translate(this.x, this.y);
        linesCtx.rotate(this.angle);
        linesCtx.strokeStyle = `rgba(255, 255, 255, ${this.opacity})`;
        linesCtx.lineWidth = 1;
        linesCtx.beginPath();
        linesCtx.moveTo(-this.length / 2, 0);
        linesCtx.lineTo(this.length / 2, 0);
        linesCtx.stroke();
        linesCtx.restore();
      }
    }

    for (let i = 0; i < 40; i++) {
      lines.push(new Line());
    }

    function animateLines() {
      linesCtx.clearRect(0, 0, linesCanvas.width, linesCanvas.height);
      lines.forEach(line => {
        line.update();
        line.draw();
      });
      requestAnimationFrame(animateLines);
    }

    animateLines();

  </script>
  <script>
        document.addEventListener('contextmenu', e => e.preventDefault());
      document.addEventListener('keydown', e => {
        if (
          e.key === "F12" ||
          (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J')) ||
          (e.ctrlKey && e.key === 'U') ||
          (e.metaKey && e.altKey && e.key === 'I')
        ) {
          e.preventDefault();
          return false;
        }
      });
      setInterval(() => {
      const widthThreshold = window.outerWidth - window.innerWidth > 100;
      const heightThreshold = window.outerHeight - window.innerHeight > 100;
      if (widthThreshold || heightThreshold) {
        document.body.innerHTML = '<h1 style="color:white;text-align:center;margin-top:40vh;">Access Denied</h1>';
      }
    }, 1000);
    </script>
</body>
</html>
